# 搜索

## 搜文档
概述：搜文档时首先通过jieba分词获取搜索请求的所有分词，
获取分词后并发搜索每个分词的倒排索引文档集，
将所有结果集合并后通过相关性算法排序并返回分页结果

### 相关性算法
借鉴 TF-IDF 算法以及 BM25 算法，并进行了改进，对于文章中出现在前后不同位置的词语采取不同权重


## 搜图片
概述：搜图片时先通过jieba分词获取请求的所有分词，
获取分词后并发搜索每个分词的倒排所有文档集，
将所有结果集合并后通过相关性算法排序后获得返回结果集

对于结果集，首先本地查询是否压缩过，
压缩过直接过去压缩图片url，
没压缩过就获取url对应图片并进行压缩，
将压缩图片上传到阿里云端，并在本地记录。
最后返回分页结果

详细请看[源码](../pkg/engine.go)

## 分页
概述：对于搜索结果，使用快速排序对键值`score`进行排序，通过前端传入页号和每页数据条数获取对应结果集的 ID 集合，
通过集合中的 ID 并发查询 badgerdb中的文档数据并做处理和封装，
最后返回分页数据。
详细请看[源码](../pkg/pagination)


## 过滤词
过滤词使用 AC 自动机进行过滤，
先对输入过滤词集合建立 AC自动机，
对分页后的结果集使用 AC自动机进行全文检索，
检索过滤词的话就过滤这个文档
详细请看[源码](../pkg/trie/ACTrie.go)
